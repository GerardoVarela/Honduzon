
<nav id="navbar" class="navbar navbar-light navbar-expand-lg navigation-clean">
  <div class="container">
    <a class="navbar-brand" href="#"
      ><img id="logo" src="../assets/logo.png" />
    </a>
    <button
      class="navbar-toggler"
      data-bs-toggle="collapse"
      data-bs-target="#navcol-1"
      >
      <span class="visually-hidden">
        Toggle navigation
      </span>
      <span class="navbar-toggler-icon"></span>
    </button>
    <div id="navcol-1" class="collapse navbar-collapse">
      <ul class="navbar-nav">
        <li class="nav-item">
          <form [formGroup]="searchForm">
            <input
              id="busqueda"
              formControlName="searchInput"
              type="search"
              placeholder="Buscar artículos"
            />
            <button type="submit" 
                    class="btn btn-link" 
                    style="box-shadow: none;"
                    (click)="search()"
                    [disabled]="(searchInput!.value === null) || (searchInput!.value === '')">
              <i id="icono-lupa" style="margin: 0!important" class="fas fa-search"></i>
            </button>
          </form>
        </li>
      </ul>
      <ul class="navbar-nav ms-auto">         
        <ng-container *ngIf="!cookieToken; else noBtnLogReg">
          <li class="nav-item" style="padding-top: 8px">
            <a role="button" (click)="open(contentLog)">
              <i id="icono-mensaje" class="far fa-paper-plane"></i>
            </a>
          </li>
          <li class="nav-item">
            <a id="mensaje" class="nav-link" role="button" (click)="open(contentLog)">Mensaje</a>
          </li>
          <li class="nav-item">
            <button
              id="btn-registro"
              class="btn btn-primary"
              type="button"
              (click)="open(contentReg)"
            >
              ¡Regístrate!
            </button>
          </li>
          <li class="nav-item" style="margin-left: 5px">
            <button
              id="btn-subirProducto"
              class="btn btn-primary"
              type="button"
              (click)="open(contentLog)"
            >
              Inicia Sesión
            </button>
          </li>
          <li class="nav-item" style="margin-left: 5px">
            <button id="btn-subirProducto" class="btn btn-primary" type="button" (click)="open(contentLog)">
              <i class="fas fa-plus-circle" style="margin-right: 5px"></i>
              Subir producto
            </button>
          </li>
        </ng-container>
        <ng-template #noBtnLogReg>
          <li class="nav-item" style="padding-top: 8px">
            <a routerLink="/chat">
              <i id="icono-mensaje" class="far fa-paper-plane"></i>
            </a>
          </li>
          <li class="nav-item">
            <a routerLink="/chat/user/{{loggedUser.idUsuario}}" id="mensaje" class="nav-link" >Mensaje</a>
          </li>
          <li class="nav-item">
            <i class="far fa-user-circle" style="color: #00BCE4; margin-left: 5px; margin-right: 5px; font-size: 40px"></i>
          </li>
          <div ngbDropdown style="padding-top:9px; margin-right:5px">
            <a
                id="dropdownUser" 
                ngbDropdownToggle
                href="#" 
                style="font-size: 18px; color:#00BCE4; font-weight: bold; text-decoration: none;">
              {{loggedUser.nombreCompleto}}
            </a>
            <div ngbDropdownMenu aria-labelledby="dropdownUser">
              <a ngbDropdownItem routerLink="/" (click)="logout(contentSuccess)">Cerrar Sesión</a>
            </div>
          </div>
          <li class="nav-item" style="margin-left: 5px">
            <button id="btn-subirProducto" class="btn btn-primary" type="button">
              <i class="fas fa-plus-circle" style="margin-right: 5px"></i>Subir
              producto
            </button>
          </li>
        </ng-template>
      </ul>
    </div>
  </div>
</nav>

<!-- Modal Login -->
<ng-template #contentLog let-modalLog>
  <div class="modal-header">
    <button
      type="button"
      class="btn-close"
      aria-label="Close"
      (click)="modalLog.dismiss('Cross click')"
    ></button>
  </div>
  <div class="modal-body col" style="text-align: center">
    <div class="row" style="padding-bottom: 20px">
      <h2 class="modal-title">¡Bienvenido!</h2>
      <small>Estamos felices de tenerte de vuelta.</small>
    </div>

    <form [formGroup]="loginForm">
      <div class="form-floating">
        <input
          type="email"
          formControlName="formEmailLogin"
          class="border-bottom-custom form-control"
          id="floatingInputLogin"
          placeholder="name@example.com"
        />
        <label for="floatingInputLogin">Correo electrónico</label>
      </div>
      <div class="form-floating">
        <input
          type="password"
          formControlName="formPasswordLogin"
          class="border-bottom-custom form-control"
          id="floatingPasswordLogin"
          placeholder="Password"
        />
        <label for="floatingPasswordLogin">Contraseña</label>
      </div>
      <button
        id="btn-modal"
        class="btn btn-primary btn-blue-animate"
        type="submit"
        (click)="login(contentSuccess)"
      >
        Iniciar Sesión
      </button>
      <div *ngIf="hayError" class="alert alert-danger">
        Correo o contraseña incorrecta.
      </div>
    </form>
    <a id="texto" href="#" (click)="open(contentRecover, true)">Recuperar Contraseña</a>
    <small style="color: #8190a5">|</small>
    <a id="texto" href="#" (click)="open(contentReg, true)">Regístrate</a>
    
    <div class="row">
      <small style="margin-top: 40px"
        >Al iniciar estás aceptando nuestros</small
      >
    </div>

    <small style="margin-bottom: 30px">
      <a id="texto" style="padding: 0px !important" href="#">Términos</a>
      y
      <a id="texto" style="padding: 0px !important" href="#">Condiciones</a>
    </small>
  </div>
</ng-template>

<!-- Modal Registro -->
<ng-template #contentReg let-modalReg>
  <div class="modal-header">
    <button
      type="button"
      class="btn-close"
      aria-label="Close"
      (click)="modalReg.dismiss('Cross click')"
    ></button>
  </div>
  <div class="modal-body col" style="text-align: center">
    <!-- Título y Subtítulo -->
    <div class="row" style="padding-bottom: 20px">
      <h2 class="modal-title">¡Regístrate!</h2>
      <small>Ingresa tus datos.</small>
    </div>

    <form [formGroup]="registerForm">
      <!-- Zona Inputs -->
      <div class="form-floating">
        <input
          type="text"
          formControlName="formName"
          class="border-bottom-custom form-control"
          id="floatingName"
          placeholder="Nombre"
          [class.is-invalid]="formName!.invalid && formName!.touched"
        />
        <label for="floatingName">Nombre*</label>
        <div class="invalid-feedback">Campo obligatorio.</div>
      </div>

      <div class="form-floating">
        <input
          type="text"
          formControlName="formLastName"
          class="border-bottom-custom form-control"
          id="floatingLastName"
          placeholder="Apellido"
          [class.is-invalid]="formLastName!.invalid && formLastName!.touched"
        />
        <label for="floatingLastName">Apellido*</label>
        <div class="invalid-feedback">Campo obligatorio.</div>
      </div>

      <div class="form-floating">
        <input
          type="email"
          formControlName="formEmail"
          class="border-bottom-custom form-control"
          id="floatingEmail"
          placeholder="nombre@ejemplo.com"
          pattern="^[_a-z0-9-]+(.[_a-z0-9-]+)*@[a-z0-9-]+(.[a-z0-9-]+)*(.[a-z]{2,4})$"
          [class.is-invalid]="formEmail!.invalid && formEmail!.touched"
        />
        <label for="floatingEmail">Correo electrónico*</label>
        <div class="invalid-feedback">
          <ng-container *ngIf="formEmail!.dirty; else elseTemplate">
            Patrón incorrecto. Ejemplo: abc_d1@efgh.ijk
          </ng-container>
          <ng-template #elseTemplate> Campo obligatorio. </ng-template>
        </div>
      </div>

      <div class="form-floating">
        <input
          type="password"
          formControlName="formPassword"
          class="border-bottom-custom form-control"
          id="floatingPassword"
          placeholder="Contraseña"
          pattern="^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[$@$!%*?&])([A-Za-z\d$@$!%*?&]|[^ ]){8,16}$"
        />
        <label for="floatingPassword">Contraseña*</label>
      </div>
      <div
        *ngIf="
          formPassword!.invalid &&
          (formPassword!.dirty || formPassword!.touched)
        "
        class="invalid-feedback-select"
      >
        <div *ngIf="formPassword!.invalid && formPassword!.touched">
          Campo Obligatorio.
        </div>
        <div *ngIf="formPassword!.invalid && formPassword!.dirty">
          La contraseña debe ser de 8-16 caracteres y tener al menos 1
          mayúscula, minúscula, número y caracter no alfanumérico.
        </div>
      </div>

      <div class="form-floating">
        <input
          type="password"
          formControlName="formVPassword"
          class="border-bottom-custom form-control"
          id="floatingVPassword"
          placeholder="Verificar Contraseña"
        />
        <label for="floatingPassword">Verificar Contraseña*</label>
      </div>
      <div
        *ngIf="
          formVPassword!.invalid &&
          (formVPassword!.dirty || formVPassword!.touched)
        "
        class="invalid-feedback-select"
      >
        <div *ngIf="formVPassword!.touched && getConfirmPasswordError() == 1">
          Campo Obligatorio.
        </div>
        <div *ngIf="formVPassword!.dirty && getConfirmPasswordError() == 2">
          La contraseña no coincide.
        </div>
      </div>

      <div class="form-floating">
        <input
          type="tel"
          formControlName="formPhone"
          class="border-bottom-custom form-control"
          id="floatingPhone"
          placeholder="nombre@ejemplo.com"
          pattern="[0-9]{4}-[0-9]{4}"
          [class.is-invalid]="
            formPhone!.invalid && (formPhone!.touched || formPhone!.dirty)
          "
        />
        <label for="floatingPhone">Teléfono*</label>
        <div class="invalid-feedback">
          <ng-container *ngIf="formPhone!.dirty; else elseTemplate">
            Patrón incorrecto. Ejemplo: 1234-5678
          </ng-container>
          <ng-template #elseTemplate> Campo obligatorio. </ng-template>
        </div>
      </div>

      <select
        class="border-bottom-custom form-select-reg"
        aria-label="Departamento"
        ngModel
        formControlName="formDept"
      >
        <option value="" disabled>Departamento*</option>
        <option *ngFor="let dep of deptos" value="{{ dep.ID_DEPARTAMENTO }}">
          {{ dep.NOMBRE_DEPARTAMENTO }}
        </option>
        <!-- <option *ngFor="let dep of deptos; let i=index" value="{{ i+1 }}">
          {{ dep }}
        </option> -->
      </select>
      <div
        *ngIf="formDept!.invalid && (formDept!.dirty || formDept!.touched)"
        class="invalid-feedback-select"
      >
        <div *ngIf="formDept!.errors?.['required']">Campo Obligatorio.</div>
      </div>

      <select
        class="border-bottom-custom form-select-reg"
        aria-placeholder="ciudad"
        ngModel
        formControlName="formCity"
      >
        <option value="" disabled>Ciudad*</option>
        <option *ngFor="let cit of ciudades" value="{{ cit.ID_CIUDAD }}">
          {{ cit.CIUDAD }}
        </option> 
      </select>
      <div
        *ngIf="formCity!.invalid && (formCity!.dirty || formCity!.touched)"
        class="invalid-feedback-select"
      >
        <div *ngIf="formCity!.errors?.['required']">Campo Obligatorio.</div>
      </div>

      <select
        class="border-bottom-custom form-select-reg"
        ngModel
        aria-label="Preguntas"
        formControlName="formPreg"
      >
      <option value="" disabled>Preguntas*</option>
        <option *ngFor="let preg of preguntas" value="{{ preg.ID_PREGUNTA }}">
          {{ preg.PREGUNTA }}
        </option>
      </select>
      <div
        *ngIf="formPreg!.invalid && (formPreg!.dirty || formPreg!.touched)"
        class="invalid-feedback-select"
      >
        <div *ngIf="formPreg!.errors?.['required']">Campo Obligatorio.</div>
      </div>

      <div class="form-floating">
        <input
          type="text"
          formControlName="formResp"
          class="border-bottom-custom form-control"
          id="floatingResp"
          placeholder="Respuesta"
          [class.is-invalid]="formResp!.invalid && formResp!.touched"
        />
        <label for="floatingResp">Respuesta*</label>
        <div class="invalid-feedback">Campo obligatorio.</div>
      </div>

      <div class="form-floating">
        <input
          type="text"
          formControlName="formDirection"
          class="border-bottom-custom form-control"
          id="floatingDirection"
          placeholder="Dirección"
        />
        <label for="floatingDirection">Dirección</label>
      </div>

      <!-- Términos y Condiciones -->
      <div class="form-check">
        <input
          formControlName="formTerms"
          class="form-check-input"
          type="checkbox"
          id="flexCheckDefault"
        />
        <label class="form-check-label" for="flexCheckDefault">
          He leído y acepto los
          <a style="color: #00bce4" href="#">Términos</a> y
          <a style="color: #00bce4" href="#">Condiciones</a> de Honduzon.
        </label>
      </div>

      <!-- Botón Registrarse -->
      <button
        id="btn-modal"
        class="btn btn-primary btn-blue-animate"
        type="submit"
        [disabled]="registerForm.invalid"
        (click)="register(contentSuccess)"
      >
        Regístrate
      </button>
    </form>

    <!-- Inicia Sesión -->
    <div class="row" style="margin-bottom: 10px">
      <a id="texto" href="#" (click)="open(contentLog, true)">Inicia Sesión</a>
    </div>
  </div>
</ng-template>

<!-- Modal Recuperar Contraseña -->
<ng-template #contentRecover let-modalRecover>
  <div class="modal-header">
    <button
      type="button"
      class="btn-close"
      aria-label="Close"
      (click)="modalRecover.dismiss('Cross click')"
    ></button>
  </div>
  <div class="modal-body col" style="text-align: center">
    <div class="row" style="padding-bottom: 20px">
      <h2 class="modal-title">Recuperar Contraseña</h2>
      <small>Recibirás un correo con tu nueva contraseña.</small>
    </div>

    <form [formGroup]="recoverForm">
      <div class="form-floating">
        <input
          type="email"
          formControlName="formEmailRecover"
          class="border-bottom-custom form-control"
          id="floatingEmailRecover"
          placeholder="name@example.com"
          pattern="^[_a-z0-9-]+(.[_a-z0-9-]+)*@[a-z0-9-]+(.[a-z0-9-]+)*(.[a-z]{2,4})$"
          [class.is-invalid]="formEmailRecover!.touched && formEmailRecover!.invalid"/>
        <label for="formEmailRecover">Correo electrónico</label>
        <div class="invalid-feedback">Campo obligatorio.</div>
      </div>

      <!-- <div class="form-check">
        <input class="form-check-input" 
                style="margin-top: 0!important" 
                type="radio" 
                value="email" 
                name="formRadioBRecover" 
                formControlName="formRadioBRecover" 
                id="flexRadioDefault1" 
                checked>
        <label class="form-check-label" for="flexRadioDefault1">
          Recibir correo electrónico
        </label>
      </div>
      <div class="form-check">
        <input class="form-check-input" 
                style="margin-top: 0!important" 
                type="radio" 
                value="question" 
                name="formRadioBRecover" 
                formControlName="formRadioBRecover"
                id="flexRadioDefault2"  (click)="showQuestion()">
        <label class="form-check-label" for="flexRadioDefault2">
          Contestar pregunta de seguridad
        </label>
      </div> -->

      <button
        id="btn-modal"
        class="btn btn-primary btn-blue-animate"
        type="submit"
        [disabled]="formEmailRecover!.value === null || formEmailRecover!.value === ''"
        (click)="recoverByEmail(contentSuccess)">
          Enviar Correo
      </button>
      <!-- <ng-container *ngIf="formRadioBRecover!.value === 'email'; else elseThenAns">
        <button
          id="btn-modal"
          class="btn btn-primary btn-blue-animate"
          type="submit"
          [disabled]="formEmailRecover!.value === null || formEmailRecover!.value === ''"
          (click)="recoverByEmail(contentSuccess)">
            Enviar Correo
        </button>
      </ng-container>
      <ng-template #elseThenAns>
        <div style="text-align: center; margin-top: 5%">
          <p id="texto" style="margin-bottom: 0!important">{{recoveryQuestion}}</p>
        </div>

        <div class="form-floating">
          <input
            type="text"
            formControlName="formRespRecover"
            class="border-bottom-custom form-control"
            id="floatingResp"
            placeholder="Respuesta"
            [class.is-invalid]="formRespRecover!.touched && (formRespRecover!.value === null || formRespRecover!.value === '')"
          />
          <label for="floatingResp">Respuesta</label>
          <div class="invalid-feedback">Campo obligatorio.</div>
        </div>

        <button
          id="btn-modal"
          class="btn btn-primary btn-blue-animate"
          type="submit"
          [disabled]="(formRespRecover!.value === null || formRespRecover!.value === '') || (formEmailRecover!.value === null || formEmailRecover!.value === '')"
          (click)="recoverByAnswer()">
            Enviar Respuesta
        </button>
      </ng-template> -->
      <div *ngIf="correoRegistrado === false" class="alert alert-danger">
        Este correo no está registrado en la plataforma.
      </div>
      <!-- <div *ngIf="(respuestaIncorrecta === true) && (correoRegistrado === true)" class="alert alert-danger">
        Respuesta incorrecta.
      </div> -->
    </form>
  </div>
</ng-template>

<!--Modal Success-->
<ng-template #contentSuccess let-modalSuccess>
  <div
    class="modal-body success-modal"
    style="text-align: center; border-radius: 20px"
  >
    <p><br />{{ successMsg }} con éxito</p>
  </div>
</ng-template>